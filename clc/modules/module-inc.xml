<project name="eucalyptus-module-import">
  <!--================================== euca defines ==================================-->
  <property environment="localenv"/>
  <property name="euca.home.0" value="${localenv.EUCALYPTUS}"/>
  <condition property="euca.home" value="/opt/eucalyptus" else="${localenv.EUCALYPTUS}">
    <contains string="${euca.home.0}" substring="localenv"/>
  </condition>
  <property name="project.basedir" value="${basedir}/../../"/>
  <loadfile srcfile="${project.basedir}/../VERSION" property="euca.version">
    <filterchain>
      <filterreader classname="org.apache.tools.ant.filters.StripLineBreaks"/>
    </filterchain>
  </loadfile>
  <property name="euca.conf.dir" value="${euca.home}/etc/eucalyptus/cloud.d"/>
  <property name="euca.lib.dir" value="${euca.home}/usr/share/eucalyptus"/>
  <property name="euca.var.dir" value="${euca.home}/var/lib/eucalyptus"/>
  <property name="euca.log.dir" value="${euca.home}/var/log/eucalyptus"/>
  <propertyset id="euca-props">
    <propertyref prefix="euca"/>
  </propertyset>
  <!--================================== module-dir defines ==================================-->
  <property name="build.dir" value="${basedir}/build"/>
  <property name="src.dir" value="${basedir}/src/main/java"/>
  <property name="conf.dir" value="${basedir}/conf"/>
  <property name="rsrc.dir" value="${basedir}/src/main/resources"/>
  <property name="target.dir" value="${project.basedir}/target"/>
  <property name="jar.file" value="${target.dir}/${ant.project.name}-${euca.version}.jar"/>
  <property name="lib.dir" value="${project.basedir}/lib"/>
  <!--================================== classpaths ==================================-->
  <path id="classpath">
    <pathelement path="${conf.dir}"/>
    <fileset dir="${target.dir}">
      <include name="**/*.jar"/>
    </fileset>
    <fileset dir="${lib.dir}">
      <include name="**/*.jar"/>
    </fileset>
  </path>
  <path id="runtimeclasspath">
    <pathelement path="${euca.conf.dir}"/>
    <fileset dir="${euca.lib.dir}">
      <include name="**/*.jar"/>
    </fileset>
  </path>
  <path id="srcpath">
    <fileset dir="${build.dir}">
      <include name="**/*"/>
    </fileset>
  </path>
  <!--================================== copy conf ==================================-->
  <target name="copy-conf">
    <copy todir="${euca.conf.dir}">
      <fileset dir="conf">
        <include name="**/*"/>
      </fileset>
    </copy>
  </target>
  <!--================================== init target ==================================-->
  <target name="init">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${target.dir}"/>
  </target>
  <target name="builder" depends="init" description="--> build the jar file from source.">
    <condition property="builder.target" value="build-${builder.suffix}" else="build-java"><isset property="builder.suffix"/></condition>
    <echo message="builder.target=${builder.target}"/>
    <antcall target="${builder.target}" inheritall="true" inheritrefs="true"/>
    <antcall target="jar"/>
  </target>
  <target name="build-java">
      <javac srcdir="src/main/java/"
             classpathref="classpath"
             destdir="${build.dir}"
             deprecation="false"
             failonerror="true"
             debug="true"
             sourcepathref="srcpath"
             target="1.5"
             listfiles="true"/>
  </target>
  <target name="build-groovy">
    <taskdef name="groovyc" classname="org.codehaus.groovy.ant.Groovyc" classpathref="classpath"/>
    <groovyc srcdir="${src.dir}" classpathref="classpath" sourcepathref="srcpath" destdir="${build.dir}" verbose="true" listfiles="true">
        <javac target="1.5" debug="true"/>
    </groovyc>
  </target>
  <target name="install" depends="copy-conf"/>
  <!--================================== clean target ==================================-->
  <target name="clean">
    <delete dir="${build.dir}" />
    <delete file="${jar.file}" />
  </target>
  <!--================================== jar target ==================================-->
  <target name="jar">
    <jar destfile="${jar.file}">
      <fileset dir="${build.dir}">
        <include name="**/*"/>
      </fileset>
      <fileset dir="${rsrc.dir}">
        <include name="**/*"/>
      </fileset>
    </jar>
  </target>
</project>
