<mule xmlns="http://www.mulesource.org/schema/mule/core/2.0"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:spring="http://www.springframework.org/schema/beans"
      xmlns:vm="http://www.mulesource.org/schema/mule/vm/2.0"
      xmlns:euca="http://www.eucalyptus.com/schema/cloud/1.6"
      xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
       http://www.mulesource.org/schema/mule/vm/2.0 http://www.mulesource.org/schema/mule/vm/2.0/mule-vm.xsd
       http://www.eucalyptus.com/schema/cloud/1.6 http://www.eucalyptus.com/schema/cloud/1.6/euca.xsd">


  <model name="eucalyptus-runtime">
    <default-service-exception-strategy>
      <outbound-endpoint ref="ReplyQueueWS"/>
    </default-service-exception-strategy>

    <service name="VmControl">
      <inbound>
        <inbound-endpoint ref="VmControlWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.ws.VmControl"/>
      <outbound>
        <outbound-pass-through-router>
          <outbound-endpoint ref="ReplyQueueWS"/>
        </outbound-pass-through-router>
      </outbound>
    </service>

      <service name="KeyPairResolve">
        <inbound>
          <inbound-endpoint ref="KeyPairResolveWS"/>
        </inbound>
        <component class="edu.ucsb.eucalyptus.cloud.ws.KeyPairBroker"/>
      </service>
      <service name="ImageResolve">
        <inbound>
          <inbound-endpoint ref="ImageResolveWS"/>
        </inbound>
        <component class="edu.ucsb.eucalyptus.cloud.ws.ImageManager"/>
      </service>

    <service name="ClusterSink">
      <inbound>
        <inbound-endpoint ref="ClusterSinkWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.cluster.ClusterEndpoint"/>
    </service>

    <service name="ClusterEndpoint">
      <inbound>
        <inbound-endpoint ref="ClusterEndpointWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.cluster.ClusterEndpoint"/>
      <outbound>
        <outbound-pass-through-router>
          <outbound-endpoint ref="ReplyQueueWS"/>
        </outbound-pass-through-router>
      </outbound>
    </service>

    <service name="Address">
      <inbound>
        <inbound-endpoint ref="AddressWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.ws.AddressManager"/>
      <outbound>
        <outbound-pass-through-router>
          <outbound-endpoint ref="ReplyQueueWS"/>
        </outbound-pass-through-router>
      </outbound>
    </service>

    <service name="SystemState">
      <inbound>
        <inbound-endpoint ref="SystemStateWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.ws.SystemState"/>
      <outbound>
        <outbound-pass-through-router>
          <outbound-endpoint ref="ReplyQueueWS"/>
        </outbound-pass-through-router>
      </outbound>
    </service>

    <service name="UpdateSystemAndReply">
      <inbound>
        <inbound-endpoint ref="UpdateSystemWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.ws.CreateVmInstances"/>
      <outbound>
        <multicasting-router>
          <outbound-endpoint ref="ClusterSinkWS"/>
          <outbound-endpoint ref="TransformReplyWS"/>
        </multicasting-router>
      </outbound>
    </service>

    <service name="TransformReply">
      <inbound>
        <inbound-endpoint ref="TransformReplyWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.ws.VmReplyTransform"/>
      <outbound>
        <outbound-pass-through-router>
          <outbound-endpoint ref="ReplyQueueWS"/>
        </outbound-pass-through-router>
      </outbound>
    </service>

  </model>

  <model name="vm-metadata">
    <service name="VmMetadata">
      <inbound>
        <inbound-endpoint ref="VmMetadataWS"/>
      </inbound>
      <component class="edu.ucsb.eucalyptus.cloud.ws.VmMetadata"/>
    </service>
  </model>

</mule>