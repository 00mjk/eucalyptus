These are build instructions for the development version of Eucalyptus.
=======================================================================

***NOTE*** The following install instructions are subject to change and 
may be INCOMPLETE. Contributions encouraged! :)

What follows are instructions to build and install Eucalyptus from source on
CentOS/RHEL v6. Eucalyptus only supports 64-bit installations of CentOS/RHEL.

You must install all dependencies to be able to build and install Eucalyptus.

1. Get the source code
======================

If "git" is not already installed:
yum install git

git clone git://github.com/eucalyptus/eucalyptus --recursive


2. Install dependencies
=======================

Follow these instructions to install required build and run-time dependencies.

Install the EPEL repository:

yum install http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm

Install the ELRepo repository (needed on the Walrus host only for DRBD packages):

yum install http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/elrepo-release-6-5.el6.elrepo.noarch.rpm

Install the Eucalyptus repository that will allow yum to find the packages
needed for building Eucalyptus that are not in the other repos. Point your
Web browser to:
http://downloads.eucalyptus.com/software/eucalyptus/nightly/devel/ 
...and drill down to find the latest version of
eucalyptus-release-nightly-<...>.rpm for your desired Linux platform. 

For example: (this won't work, don't copy & paste it)
yum install http://downloads.eucalyptus.com/software/eucalyptus/nightly/devel/centos/6/x86_64/eucalyptus-release-nightly-0-2x.el6.noarch.rpm  
Use the latest version number and the right intermediary paths for your platform.

Install the following build dependencies:

yum groupinstall development

yum-builddep eucalyptus

Download and save the following file to /opt, and make it executable.

cd /opt
wget https://raw.github.com/eucalyptus/eucalyptus-rpmspec/master/euca-WSDL2C.sh
chmod +x euca-WSDL2C.sh

Download the Apache Ivy 2.1.0 tarball and replace the Ivy jar installed by
the "apache-ivy" yum install.

wget http://archive.apache.org/dist/ant/ivy/2.1.0/apache-ivy-2.1.0-bin.tar.gz
tar -zxvf apache-ivy-2.1.0-bin.tar.gz
cp -p apache-ivy-2.1.0/ivy-2.1.0.jar /usr/share/java
ln -fs /usr/share/java/ivy-2.1.0.jar /usr/share/java/ivy.jar


3. Set Environment Variables
============================

Define the following variables. Typically, they would go into
/root/.bashrc. Remember to log out and log in again (or "source .bashrc")
after editing it.

Define the required JAVA environment variables:
(Verify these are correct for your system)

export JAVA_HOME="/usr/lib/jvm/java-1.7.0/"
export JAVA="$JAVA_HOME/bin/java"

Define the root directory where you want the tree of built Eucalyptus
binaries to be placed. 

If this is the only system you'll be running Eucalyptus on, as a
cloud-in-a-box, then you can let that root be the root of the filesystem,
"/". Files will then be placed in the directories /etc, /usr, and /var:

export EUCALYPTUS="/"

If instead you intend to deploy the binaries you build on this system to
other systems and run that set of systems as a Eucalyptus cloud, then it's
best to pick a directory that you can rsync to the other machines easily,
for example:

export EUCALYPTUS="/opt/eucalyptus"

Be sure to create (mkdir) that directory if it does not yet exist.


4. Build Eucalyptus
===================

Run the "configure" script to prepare the system to build:

./configure --with-axis2==/usr/share/java/axis2 \
--with-axis2c=/usr/lib64/axis2c --prefix=$EUCALYPTUS \
--with-apache2-module-dir=/usr/lib64/httpd/modules \
--with-db-home=/usr/pgsql-9.2 \
--with-wsdl2c-sh=/opt/euca-WSDL2C.sh

Run the "make" to clean the outputs from any previous build, build the
binaries, and install all built files into the $EUCALYPTUS directory tree.

make clean ; make ; make install

Repeat these 3 makes for each new build.

To restore the source tree to a pristine state, removing even more than
"make clean" does:

make distclean


5. Distribute the Build
=======================

At this point, if you plan to use Eucalyptus on more than one system, you're
ready to push the software out to the other systems.

Perform steps 2 and 3 above on each system. Although not all software
components are required on all systems, it is simpler to just mirror
everything and selectively enable components via start-up scripts.

You don't need to build the code again (skip step 3).

If you built Eucalyptus into its own directory as described above, where
$EUCALYPTUS is not set to "/", then you can just sync the entire built tree
to all of the other systems using whatever mechanism you typically use to
push changes to systems. For example, using rsync:

rsync -ar $EUCALYPTUS/ root@{host-2}:$EUCALYPTUS/
rsync -ar $EUCALYPTUS/ root@{host-3}:$EUCALYPTUS/
...

NOTE: For any systems running the NC you will also need to copy the
policykit configuration file separately, since he build places it in /var
and not within the $EUCALYPTUS tree like the other built files. Copy the
file:
./tools/eucalyptus-nc-libvirt.pkla
...to the NC and put it in the directory:
/var/lib/polkit-1/localauthority/10-vendor.d/


6. Configure Eucalyptus
=======================

At this point forward, please follow instructions from the "Configuring
Eucalyptus" section of the Installation Guide.

You can access Eucalyptus Documentation here:
http://docs.hpcloud.com/eucalyptus


7. Run Eucalyptus
=================

Eucalyptus comes with the euca_conf script for configuring Eucalyptus. For
some requests it modifies the configuration file located in
'$EUCALYPTUS/etc/eucalyptus/eucalyptus.conf' (which can also be edited
manually), for other requests it modifies the database maintained by the
Cloud Controller (much of that functionality is duplicated in the Web
interface, to be described later).

In addition to modifying the configuration, euca_conf attempts to
synchronize x509 credentials across the nodes of a Eucalyptus installation
by relying on rsync and scp. We highly recommend setting up password-less
SSH access for the root user across all nodes of your Eucalyptus
installation (otherwise, euca_conf will prompt you for remote system
passwords).

As explained in the overview, a Eucalyptus installation consists of five
types of components: cloud controller (CLC), User Facing Services (UFS/API),
cluster controller (CC), storage controller (SC), and the node controller(s)
(NCs). In following instructions we assume that all components except the
NCs are co-located on one machine that we refer to as the front end and that
NCs run on one or more other machines referred to ascompute nodes.

To run Eucalyptus, first, make sure that you have all of the runtime
dependencies of Eucalyptus installed, based on your chosen set of
configuration parameters. If there is a problem with runtime dependencies
(for instance, if Eucalyptus cannot find/interact with them), all errors
will be reported in log files located in $EUCALYPTUS/var/log/eucalyptus. For
more information on Eucalyptus log files and error reports, please see
Troubleshooting Eucalyptus.

Next, inspect the contents of $EUCALYPTUS/etc/eucalyptus/eucalyptus.conf
carefully, on each machine, to make sure that the settings are appropriate
for your environment. Once you have confirmed that everything is configured
properly, enable the cloud services on the front-end:

# enable services on the front-end
$EUCALYPTUS/usr/sbin/euca_conf -d $EUCALYPTUS --setup

#Initialize the DB on the host that will be the CLC component.
$EUCALYPTUS/usr/sbin/euca_conf -d $EUCALYPTUS --initialize

Start each component on the appropriate host.

# start enabled front-end services
$EUCALYPTUS/etc/init.d/eucalyptus-cloud start

# start the cluster controller
$EUCALYPTUS/etc/init.d/eucalyptus-cc start

And on each of the compute nodes run:

$EUCALYPTUS/etc/init.d/eucalyptus-nc start

To stop them you call the script with stop instead of start.

